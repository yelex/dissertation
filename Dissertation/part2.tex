\chapter{Описание механизма сбора и обработки данных по ценам}\label{ch:ch2}
В России, как и во всем мире, в последние годы наблюдается тенденция к наращиванию объемов интернет-торговли. Данные Ассоциации компаний интернет-торговли показывают, что объем интернет-торговли в России за последние 9 лет вырос практически в 10 раз  --- с 713 млрд рублей в 2014 году до 6,3 трлн рублей в 2023 году. Развитие сегмента ускорилось в период пандемии, когда население оказалось в условиях коронавирусных ограничений, что привело к росту онлайн-покупок. Рост интернет-торговли привел также к росту данных по ценам на отдельные товары и услуги, доступные к покупке через интернет, что существенно расширило возможности исследователей для сбора данных и анализа поведения цен на микроуровне. В настоящей главе будет описана методика сбора данных, характеристики собранных данных, а также трудности, с которыми исследователь может столкнуться в процессе сбора данных и возможные пути решения этих трудностей с учетом накопленного опыта.
\section{Методика сбора данных по ценам онлайн-ритейлеров}\label{sec:ch2/sec1}

Механизм сбора данных работает следующим образом: исследователи совместно с техническими специалистами разрабатывают программные коды на Python, которые ежедневно запускаются на удаленном сервере. Эти программы автоматически собирают информацию о текущей цене товара, скидочной цене (если товар продается по сниженной цене), названии товара, ссылке на товар, а также в некоторых случаях о дополнительных характеристиках, таких как вес, цвет, размер упаковки и другие.

Одним из важных преимуществ онлайн-данных является их относительно низкая стоимость сбора. Написанная однажды программа и расходы на обслуживание сервера значительно дешевле, чем содержание штата сотрудников, которые должны регулярно посещать точки продаж и вносить цены в базу данных. Кроме того, вероятность совершения ошибки из-за человеческого фактора минимизируется, так как человек не участвует в процессе сбора данных. Программа автоматически собирает данные, однако требуется контроль за корректностью собранных данных. Это не вызывает существенных затрат в плане когнитивных и физических усилий. Важным преимуществом собранных данных является их высокая частотность, что позволяет отслеживать ценовые тенденции практически в режиме реального времени, особенно на площадках онлайн-ритейла.

Процесс сбора онлайн-данных о ценах устроен следующим образом. Ежедневно или с любой другой частотой программа анализирует и извлекает данные из разметки сайта, содержащей информацию о товаре и его стоимости. Если разметка меняется, возникает ошибка, требующая обновления кода. Следует отметить, что по опыту автора такие ошибки возникают редко. Затем информация обрабатывается и проверяется на ошибки, чтобы соответствовать формату базы данных, и заносится в нее.

Главным недостатком собранных онлайн-данных является малое покрытие категорий и точек продаж. Но последние исследования показывают, что это недостаток постепенно устраняется. Например, доля онлайн-продаж в общем обороте розничной торговли в России увеличилась с 2\% в 2019 году до 9,2\% в 2021 году, согласно данным ассоциации интернет-торговли.

Выбор сайтов, с которых собирается информация, является важным аспектом. Если исследователь стремится определить тенденции в офлайн-сегменте по ценам в онлайн-ритейле, рекомендуется отдать предпочтение мультиканальным ритейлерам, которые предлагают продукцию как онлайн, так и в офлайн точках продаж. В таких случаях цены на товары обычно совпадают в 72\% случаев и изменения цен происходят с одинаковой частотой и амплитудой.

Для достижения репрезентативности важно учитывать размеры ритейлеров и выбирать те, которые занимают значительную долю в расходах потребителей. Также следует сосредоточиться на категориях товаров, входящих в традиционную корзину потребления домохозяйств.

Что касается выбора сайтов для сбора данных о товарах, рекомендуется предпочитать онлайн-ритейлеров, так как другие источники, такие как агрегаторы и третьи сайты, не всегда предоставляют актуальную информацию о товарах и их характеристиках. Нельзя гарантировать, что сделки проводятся по ценам, указанным на таких сайтах-агрегаторах.

\section{Методологические проблемы сбора данных и возможные способы их решения}\label{sec:ch2/sec2}


\subsection{Проблема выбора ритейлеров}\label{subsec:ch2/sec2/sub1}

Главная проблема, с которой исследователь сталкивается при сборе данных из интернета, заключается в определении круга сайтов онлайн-ритейлеров, с которых необходимо собирать соответствующую информацию. Выбор этих сайтов сильно зависит от цели формирования базы данных. 

Если цель состоит в том, чтобы создать индекс цен, который позволит сделать наиболее точные выводы о поведении цен в обычных традиционных магазинах и приблизить официальную инфляцию, то, по нашему мнению, имеет смысл придерживаться методологии, представленной в \cite{cavallo2016billion}. Эта методология предполагает сбор данных о ценах с сайтов ритейлеров, которые продают одни и те же товары как онлайн, так и офлайн, но преимущественно последним способом. Источник \cite{cavallo2016online} показывает, что динамика цен на товары у таких ритейлеров в онлайн- и офлайн-сегментах во многом схожа, что позволяет с некоторой уверенностью делать выводы о поведении цен в традиционных точках продаж на основе этих данных. На практике мы столкнулись с тем, что доля мультиканальных ритейлеров среди всех онлайн-ритейлеров в российских условиях не очень высока, но мы старались включать их в базу данных насколько это было возможно.

\subsection{Замещение наблюдений вследствие исчезновения товаров из продажи }\label{subsec:ch2/sec2/sub2}

Для расчета индекса потребительских цен во времени необходимо иметь непрерывные данные для каждого товара или услуги. Однако иногда возникают ситуации, когда цены на наблюдаемые товары недоступны по разным причинам. В таких случаях требуется заменить отсутствующие данные, чтобы обеспечить сопоставимость индекса цен во времени.

На самом низком уровне агрегирования (на уровне товаров и услуг в конкретном городе) Росстат собирает данные о ценах на 5-10 товаров и услуг с определенными характеристиками. Например, для товара "молоко питьевое цельное пастеризованное 2,5-3,2\% жирности"~могут собираться данные о различных марках молока с жирностью 3,2\%. Если цена на конкретный товар отсутствует, Росстат рекомендует собирать информацию о ценах на более широкий круг товаров с похожими потребительскими свойствами. Это позволяет использовать дополнительные данные при подборе замены для отсутствующих товаров.

Кроме того, Росстат предлагает множество методов замены цен на отсутствующие товары в зависимости от природы товара и причин его отсутствия. Все эти методы позволяют обеспечивать непрерывность рядов с индексом цен во времени, но требуют сложных процедур и принятия решений для каждой конкретной ситуации исчезновения товара.

Однако сбор данных с сайтов онлайн-ритейлеров позволяет значительно снизить проблему замещения отсутствующих данных, так как это не требует больших затрат. Наш опыт подтверждает, что чем больше товаров с определенными свойствами собирается, тем ближе совокупный индекс цен по этой группе к официальному индексу.

\subsection{Отнесение товара к категории}\label{subsec:ch2/sec2/sub3}

Зачастую исследования ценовых тенденций связаны с анализом этих тенденций для определенных категорий товаров и услуг. Как правило, и в отечественной, и в зарубежной литературе этот анализ идет по категориям, к которым относятся конкретные марки товаров и услуг. Для предотвращения искажения получаемых выводов необходимо иметь возможность максимально точно соотносить эти марки товаров и услуг с их категориями.

Обычно соотнесение товаров конкретных марок с их категориями происходит путем сопоставления характеристик товаров с теми характеристиками, которыми должна обладать данная категория товаров. В случае с товарами онлайн-ритейлеров мы зачастую владеем полной информацией о названии товара, единице его измерения и прочих характеристиках, что позволяет нам довольно точно решать задачу отнесения товара к той или иной категории.

В рамках настоящего исследования использовался ручной отбор, по которому для каждой категории товара отбиралась конкретная товарная позиция на сайте с необходимыми свойствами. В таблице \cref{tab:products} приведен пример такого соотнесения. Результаты исследования \cite{cavallo2016billion} показали, что такой подход позволил сформировать индекс цен, очень близкого к динамике официального показателя официальной инфляции. Вместе с тем следует отметить, что такой подход обладает двумя важными недостатками. Во-первых, он является трудозатратным, поскольку исследователю необходимо проделать большую работу по ручному соотнесению товаров к конкретным категориям. Во-вторых, со временем отобранные позиции начинают исчезать из продажи, что вновь требует от исследователя поиск похожего товара. 


\begin{table}[h]
    \centering
    \caption{Соответствие товаров-услуг представителям}
    \begin{tabularx}{\textwidth}{@{}XX@{}}
        \toprule
       
        \textbf{Товар- (услуга-) представитель} & \textbf{Конкретный товар (услуга)} \\ \midrule
        Молоко питьевое цельное пастеризованное 2,5-3,2\% жирности & Молоко Избёнка пастеризованное 3.2\% 900 мл \\ 
        & Молоко Valio 3.2\% 1 л \\ \midrule
        Сметана & Сметана Простоквашино 20\% 300 г \\ 
        & Сметана ЭкоНива 20\% 300 г \\ 
        \bottomrule
    \end{tabularx}
    
    \label{tab:products}
\end{table}



Отдельным значимым недостатком данных онлайн-ритейлеров в настоящий момент остается низкая географическая репрезентативность. Данные, представленные в настоящем исследовании, собраны только по московскому региону, что является главным препятствием для распространения выводов, полученных на этих данных, на остальные регионы страны.

Наш опыт показал, что онлайн-ритейлеры имеют свои представительства только в городах с числом жителей более 1 млн. Вместе с тем стоит отметить, что этот недостаток постепенно нивелируется, поскольку интернет-торговля постепенно распространяется и на регионы.

\section{Технические проблемы сбора данных и возможные способы их решения}\label{sec:ch2/sec3}

Наряду с методологическими сложностями мы столкнулись с трудностями технического характера, которые, на наш взгляд, заслуживают пристального внимания. Среди проблем можно выделить блокировку программы-парсера со стороны онлайн-ритейлера, изменение разметки сайта и прочие технические трудности. В данном подразделе будут описаны эти проблемы, а также наш опыт их решения.

\subsection{Обход блокировок}\label{subsec:ch2/sec3/sub1}

Одной из существенных трудностей является блокировка программы-парсера со стороны онлайн-ритейлера. Крупные онлайн-ритейлеры опасаются DDoS-атаки, при которых совершается большое количество запросов на веб-ресурс с целью вывести его из строя. Чтобы этого недопустить, онлайн-ритейлеры повсеместно блокируют попытки автоматического сбора данных с их сайтов. Обычно это происходит спустя время после успешного начала сбора данных, что делает проблему в некотором смысле непредсказуемой. Мы, как добросовестные исследователи, также столкнулись с этой проблемой в процессе сбора данных.

Стоит подчеркнуть, что эта проблема стала острой спустя долгое время после начала сбора данных (февраль 2019 г.). На момент написания данного текста (июль 2024 года) почти все онлайн-ритейлеры обладают достаточно серьезными защитами от автоматического сбора данных с их сайтов. В связи с этим исследователи должны учитывать такие механизмы блокировки и пытаться увеличивать время между запросами, а также по возможности запускать программы по сбору данных в ночное время для того, чтобы создавать как можно меньшую нагрузку на серверы онлайн-ритейлеров и не подвергаться блокировке с их стороны.

\subsection{Проблема изменения разметки сайта}\label{subsec:ch2/sec3/sub2}

Еще одним препятствием для устойчивого сбора данных во времени является изменение разметки сайта. Информация по товарам (включая название товара, стоимость, единица измерения и пр.) на сайтах онлайн-ритейлеров находится в определенных частях HTML-разметки. Эти части содержат в себе названия классов, id и прочих атрибутов, которые позволяют однозначно идентифицировать их местоположение на сайте и, соответственно, извлекать из них нужную информацию. Однако с течением времени названия этих частей меняется, что приводит к сбою в работе программы сбора данных. Так, например, информация о цене может содержаться в части сайта с названием "price\", а после изменения разметки та же информация о цене будет содержаться в части с названием "item-price". Таким образом, жесткая привязка программы по сбору данных к разметке приведет к сбою, либо станет возвращать пустые значения.

Наш опыт показал, что такая проблема возникает регулярно, однако эта регулярность непостоянна для различных сайтов и зависит от типа товаров и услуг. Так, к примеру, на сайтах большинства продовольственных онлайн-ритейлеров, используемых в нашей выборке, разметка вовсе не изменилась за все время сбора, а на отдельных сайтах непродовольственных онлайн-ритейлеров названия классов менялись практически каждый день. Таким образом, изменение разметки стало одним из главных препятствий на пути сбора данных.

\subsection{Прочие технические затруднения}\label{subsec:ch2/sec3/sub2}

Помимо проблем, обозначенных выше, на нашем пути сбора данных возникали и прочие, менее очевидные проблемы. Так, к примеру, один из продовольственных онлайн-ритейлеров изменил название сайта, что вызвало необходимость менять ссылки на все товары. Также возникла проблема при введении новой маркировки молочной продукции (например, название товара "Молоко Простоквашино 3,2\% жирности" было заменено на "БЗМЖ Молоко Простоквашино 3,2\% жирности"), что привело к временным трудностям с однозначной идентификацией товара во времени. Наконец, существует проблема недоступности сайта из-за проведения технических работ во время сбора данных. Такие трудности время от времени возникают, однако по нашему опыту являются менее критичными, по сравнению с блокировками и изменениями структуры сайта.

Отдельной проблемой является необходимости использования существенных аппаратных мощностей при проведении сбора данных. Для покрытия большого круга ритейлеров с десятками тысяч товаров требуется развитая инфраструктура сервером, способная обеспечивать бесперебойный сбор данных в течение адекватного времени.





